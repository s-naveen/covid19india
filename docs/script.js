var sort_order,all_data=[],statewise={},maxConfirmed=0,lastUpdated="",confirmed_delta=0,deaths_delta=0,recovered_delta=0,states_delta=0,numStatesInfected=0,sort_field=0,sheet_id="ovd0hzm";function is_touch_device(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}function initMapStuff(){var t=L.map("map").setView([22.5,82],3);t.setMaxBounds(t.getBounds()),t.setView([22.5,82],4),is_touch_device()&&(t.dragging.disable(),t.tap.disable()),L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2hhZmVlcS1ldCIsImEiOiJjazgwZ2Jta20wZ2lxM2tsbjBmbnpsNGQyIn0.JyWxwnlx0oDopQ8JWM8YZA",{maxZoom:6,minZoom:4,id:"mapbox/light-v9",tileSize:512,zoomOffset:-1}).addTo(t);var e,a=L.control();function r(t){e.resetStyle(),a.update();var r=t.target;r.setStyle({weight:1,color:"#000000",dashArray:""}),L.Browser.ie||L.Browser.opera||L.Browser.edge||r.bringToFront(),a.update(r.feature.properties)}function l(t){e.resetStyle(t.target),a.update()}a.onAdd=function(t){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},a.update=function(t){t&&(this._div.innerHTML="<h4>"+t.NAME_1+"</h4><pre>Confirmed: "+statewise[t.NAME_1][1]+"<br>Recovered: "+statewise[t.NAME_1][2]+"<br>Deaths   : "+statewise[t.NAME_1][3]+"<br>Active   : "+statewise[t.NAME_1][4]+"</pre>")},a.addTo(t),e=L.geoJson(statesData,{style:function(t){var e=0;return statewise[t.properties.NAME_1]&&(e=statewise[t.properties.NAME_1][1]),{weight:1,opacity:1,color:"#bfbfbf",fillOpacity:.05*(e>0)+e/maxConfirmed*.9,fillColor:"red"}},onEachFeature:function(t,e){e.on({mouseover:r,mouseout:l,click:r})}}).addTo(t)}function getLocalTime(t){try{let e=new Date(t.replace("at ","")+" GMT+530");return moment(+e).from()}catch(e){return t}}function constructTable(t){for(var e="<thead>",a=0;a<t.length;a++)if(0==a)e+="<tr>",t[a].forEach((function(t,a){e+="<th><a href='' col_id='"+a+"' onclick='sort(this,event)'>"+t+"</a></th>"})),e+="</tr></thead><tbody>";else{if(1==a)continue;tempdata=Array.from(t[a]),tempdata.splice(0,1),allzero=!0,tempdata.forEach((function(t){0!=t&&(allzero=!1)})),allzero||(numStatesInfected++,e+="<tr>",t[a].forEach((function(t){e+="<td>"+t+"</td>"})),e+="</tr>")}return e+='<tr class="totals">',t[1].forEach((function(t){e+="<td>"+t+"</td>"})),e+="</tr>",e+="</tbody>",t.forEach((function(t){e+=t[0]})),$("table#prefectures-table").html(e),e}function sort(t,e){e.stopPropagation(),e.preventDefault();const a=$(t).attr("col_id");var r=all_data.splice(0,2);(sort_order=a==sort_field?sort_order:void 0)||(sort_order=0==a?"A":"D"),all_data.sort((t,e)=>"Total"==t?-1:"Total"==e?0:(0!=a&&(t[a]=parseInt(t[a]),e[a]=parseInt(e[a])),"D"==sort_order?t[a]>e[a]?-1:1:t[a]>e[a]?1:-1)),all_data.unshift(r[1]),all_data.unshift(r[0]),sort_field=a,sort_order="A"==sort_order?"D":"A",constructTable(all_data)}$.getJSON("https://api.covid19india.org/state_wise_raw.json",(function(t){entries=t.feed.entry,entries.forEach((function(t){null==all_data[t.gs$cell.row-1]&&(all_data[t.gs$cell.row-1]=[]),all_data[t.gs$cell.row-1][t.gs$cell.col-1]=t.gs$cell.$t})),maxConfirmed=all_data[2][1],lastUpdated=getLocalTime(all_data[1][5]),confirmed_delta=all_data[1][6],deaths_delta=all_data[1][7],recovered_delta=all_data[1][8],states_delta=all_data[1][9];for(var e=0;e<all_data.length;e++)all_data[e].splice(5);all_data.forEach((function(t){statewise[t[0]]=t})),tablehtml=constructTable(all_data),$("div#states-value").html(numStatesInfected),$("div#confvalue").html(all_data[1][1]),$("div#deathsvalue").html(all_data[1][3]),$("div#recoveredvalue").html(all_data[1][2]),$("strong#last-updated").html(lastUpdated),confirmed_delta&&$("div#confirmed_delta").html("( +"+confirmed_delta+")"),deaths_delta&&$("div#deaths_delta").html("( +"+deaths_delta+")"),recovered_delta&&$("div#recovered_delta").html("( +"+recovered_delta+")"),states_delta&&$("div#states_delta").html("( +"+states_delta+")"),initMapStuff()}));

var alldata=[],statewise={},maxConfirmed=0,lastUpdated="",confirmed_delta=0,deaths_delta=0,recovered_delta=0,states_delta=0,sheet_id="ovd0hzm";function is_touch_device(){try{return document.createEvent("TouchEvent"),!0}catch(t){return!1}}function initMapStuff(){var t=L.map("map").setView([22.5,82],3);t.setMaxBounds(t.getBounds()),t.setView([22.5,82],4),is_touch_device()&&(t.dragging.disable(),t.tap.disable()),L.tileLayer("https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoianVuYWlkYmFidSIsImEiOiJqc2ZuNkhFIn0.rdicmW4uRhYuHZxEK9dRbg",{maxZoom:6,minZoom:4,id:"mapbox/light-v9",tileSize:512,zoomOffset:-1}).addTo(t);var e,a=L.control();function l(t){e.resetStyle(),a.update();var l=t.target;l.setStyle({weight:1,color:"#000000",dashArray:""}),L.Browser.ie||L.Browser.opera||L.Browser.edge||l.bringToFront(),a.update(l.feature.properties)}function d(t){e.resetStyle(t.target),a.update()}a.onAdd=function(t){return this._div=L.DomUtil.create("div","info"),this.update(),this._div},a.update=function(t){t&&(this._div.innerHTML="<h4>"+t.NAME_1+"</h4><pre>Confirmed: "+statewise[t.NAME_1][1]+"<br>Recovered: "+statewise[t.NAME_1][2]+"<br>Deaths   : "+statewise[t.NAME_1][3]+"<br>Active   : "+statewise[t.NAME_1][4]+"</pre>")},a.addTo(t),e=L.geoJson(statesData,{style:function(t){var e=0;return statewise[t.properties.NAME_1]&&(e=statewise[t.properties.NAME_1][1]),{weight:1,opacity:1,color:"#bfbfbf",fillOpacity:.05*(e>0)+e/maxConfirmed*.9,fillColor:"red"}},onEachFeature:function(t,e){e.on({mouseover:l,mouseout:d,click:l})}}).addTo(t)}function getLocalTime(t){try{let e=new Date(t.replace("at ","")+" GMT+530");return moment(+e).from()}catch(e){return t}}$.getJSON("https://spreadsheets.google.com/feeds/cells/1nzXUdaIWC84QipdVGUKTiCSc5xntBbpMpzLm6Si33zk/"+sheet_id+"/public/values?alt=json",(function(t){entries=t.feed.entry,entries.forEach((function(t){null==alldata[t.gs$cell.row-1]&&(alldata[t.gs$cell.row-1]=[]),alldata[t.gs$cell.row-1][t.gs$cell.col-1]=t.gs$cell.$t})),maxConfirmed=alldata[2][1],lastUpdated=getLocalTime(alldata[1][5]),confirmed_delta=alldata[1][6],deaths_delta=alldata[1][7],recovered_delta=alldata[1][8],states_delta=alldata[1][9];for(var e=0;e<alldata.length;e++)alldata[e].splice(5);alldata.forEach((function(t){statewise[t[0]]=t}));var a=0,l="<thead>";for(e=0;e<alldata.length;e++)if(0==e)l+="<tr>",alldata[e].forEach((function(t){l+="<th>"+t+"</th>"})),l+="</tr></thead><tbody>";else{if(1==e)continue;tempdata=Array.from(alldata[e]),tempdata.splice(0,1),allzero=!0,tempdata.forEach((function(t){0!=t&&(allzero=!1)})),allzero||(a++,l+="<tr>",alldata[e].forEach((function(t){l+="<td>"+t+"</td>"})),l+="</tr>")}l+='<tr class="totals">',alldata[1].forEach((function(t){l+="<td>"+t+"</td>"})),l+="</tr>",l+="</tbody>",alldata.forEach((function(t){l+=t[0]})),$("table#prefectures-table").html(l),$("div#states-value").html(a),$("div#confvalue").html(alldata[1][1]),$("div#deathsvalue").html(alldata[1][3]),$("div#recoveredvalue").html(alldata[1][2]),$("strong#last-updated").html(lastUpdated),confirmed_delta&&$("div#confirmed_delta").html("( +"+confirmed_delta+")"),deaths_delta&&$("div#deaths_delta").html("( +"+deaths_delta+")"),recovered_delta&&$("div#recovered_delta").html("( +"+recovered_delta+")"),states_delta&&$("div#states_delta").html("( +"+states_delta+")"),initMapStuff()}));
